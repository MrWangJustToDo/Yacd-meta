import{i as re,f as A,ao as _e,ap as ne,aq as Re,R as w,ar as xe,as as F,at as Me,au as be,av as K,r as k,Z as U,aw as Oe,K as se,a1 as ze,j as d,a0 as Te,B as Ce,u as ie,b as we,g as Pe,C as Ee}from"./index-864353ba.js";import{_ as V,m as W}from"./memoize-one.esm-efa1e849.js";import{R as ae,T as Ne}from"./TextFitler-b1b88db2.js";import{f as je}from"./index-84fa0cb3.js";import{F as ke,p as Ae}from"./Fab-945424a7.js";import{u as Le}from"./useRemainingViewPortHeight-d693becd.js";import"./rotate-cw-72e5bcb7.js";import"./debounce-c1ba2006.js";var We=function(r){re(e,r);function e(n,s){var a;return a=r.call(this)||this,a.client=n,a.setOptions(s),a.bindMethods(),a.updateResult(),a}var t=e.prototype;return t.bindMethods=function(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)},t.setOptions=function(s){this.options=this.client.defaultMutationOptions(s)},t.onUnsubscribe=function(){if(!this.listeners.length){var s;(s=this.currentMutation)==null||s.removeObserver(this)}},t.onMutationUpdate=function(s){this.updateResult();var a={listeners:!0};s.type==="success"?a.onSuccess=!0:s.type==="error"&&(a.onError=!0),this.notify(a)},t.getCurrentResult=function(){return this.currentResult},t.reset=function(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})},t.mutate=function(s,a){return this.mutateOptions=a,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,A({},this.options,{variables:typeof s<"u"?s:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()},t.updateResult=function(){var s=this.currentMutation?this.currentMutation.state:_e(),a=A({},s,{isLoading:s.status==="loading",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=a},t.notify=function(s){var a=this;ne.batch(function(){a.mutateOptions&&(s.onSuccess?(a.mutateOptions.onSuccess==null||a.mutateOptions.onSuccess(a.currentResult.data,a.currentResult.variables,a.currentResult.context),a.mutateOptions.onSettled==null||a.mutateOptions.onSettled(a.currentResult.data,null,a.currentResult.variables,a.currentResult.context)):s.onError&&(a.mutateOptions.onError==null||a.mutateOptions.onError(a.currentResult.error,a.currentResult.variables,a.currentResult.context),a.mutateOptions.onSettled==null||a.mutateOptions.onSettled(void 0,a.currentResult.error,a.currentResult.variables,a.currentResult.context))),s.listeners&&a.listeners.forEach(function(o){o(a.currentResult)})})},e}(Re);function oe(r,e,t){var n=w.useRef(!1),s=w.useState(0),a=s[1],o=xe(r,e,t),m=F(),u=w.useRef();u.current?u.current.setOptions(o):u.current=new We(m,o);var p=u.current.getCurrentResult();w.useEffect(function(){n.current=!0;var M=u.current.subscribe(ne.batchCalls(function(){n.current&&a(function(_){return _+1})}));return function(){n.current=!1,M()}},[]);var y=w.useCallback(function(M,_){u.current.mutate(M,_).catch(Me)},[]);if(p.error&&be(void 0,u.current.options.useErrorBoundary,[p.error]))throw p.error;return A({},p,{mutate:y,mutateAsync:p.mutate})}var De=typeof performance=="object"&&typeof performance.now=="function",G=De?function(){return performance.now()}:function(){return Date.now()};function Z(r){cancelAnimationFrame(r.id)}function $e(r,e){var t=G();function n(){G()-t>=e?r.call(null):s.id=requestAnimationFrame(n)}var s={id:requestAnimationFrame(n)};return s}var D=-1;function J(r){if(r===void 0&&(r=!1),D===-1||r){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",document.body.appendChild(e),D=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return D}var T=null;function X(r){if(r===void 0&&(r=!1),T===null||r){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";var n=document.createElement("div"),s=n.style;return s.width="100px",s.height="100px",e.appendChild(n),document.body.appendChild(e),e.scrollLeft>0?T="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?T="negative":T="positive-ascending"),document.body.removeChild(e),T}return T}var Fe=150,Ue=function(e,t){return e};function Be(r){var e,t=r.getItemOffset,n=r.getEstimatedTotalSize,s=r.getItemSize,a=r.getOffsetForIndexAndAlignment,o=r.getStartIndexForOffset,m=r.getStopIndexForStartIndex,u=r.initInstanceProps,p=r.shouldResetStyleCacheOnItemSizeChange,y=r.validateProps;return e=function(M){re(_,M);function _(R){var i;return i=M.call(this,R)||this,i._instanceProps=u(i.props,K(i)),i._outerRef=void 0,i._resetIsScrollingTimeoutId=null,i.state={instance:K(i),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof i.props.initialScrollOffset=="number"?i.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},i._callOnItemsRendered=void 0,i._callOnItemsRendered=W(function(l,c,h,v){return i.props.onItemsRendered({overscanStartIndex:l,overscanStopIndex:c,visibleStartIndex:h,visibleStopIndex:v})}),i._callOnScroll=void 0,i._callOnScroll=W(function(l,c,h){return i.props.onScroll({scrollDirection:l,scrollOffset:c,scrollUpdateWasRequested:h})}),i._getItemStyle=void 0,i._getItemStyle=function(l){var c=i.props,h=c.direction,v=c.itemSize,I=c.layout,f=i._getItemStyleCache(p&&v,p&&I,p&&h),g;if(f.hasOwnProperty(l))g=f[l];else{var S=t(i.props,l,i._instanceProps),b=s(i.props,l,i._instanceProps),O=h==="horizontal"||I==="horizontal",N=h==="rtl",j=O?S:0;f[l]=g={position:"absolute",left:N?void 0:j,right:N?j:void 0,top:O?0:S,height:O?"100%":b,width:O?b:"100%"}}return g},i._getItemStyleCache=void 0,i._getItemStyleCache=W(function(l,c,h){return{}}),i._onScrollHorizontal=function(l){var c=l.currentTarget,h=c.clientWidth,v=c.scrollLeft,I=c.scrollWidth;i.setState(function(f){if(f.scrollOffset===v)return null;var g=i.props.direction,S=v;if(g==="rtl")switch(X()){case"negative":S=-v;break;case"positive-descending":S=I-h-v;break}return S=Math.max(0,Math.min(S,I-h)),{isScrolling:!0,scrollDirection:f.scrollOffset<S?"forward":"backward",scrollOffset:S,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._onScrollVertical=function(l){var c=l.currentTarget,h=c.clientHeight,v=c.scrollHeight,I=c.scrollTop;i.setState(function(f){if(f.scrollOffset===I)return null;var g=Math.max(0,Math.min(I,v-h));return{isScrolling:!0,scrollDirection:f.scrollOffset<g?"forward":"backward",scrollOffset:g,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._outerRefSetter=function(l){var c=i.props.outerRef;i._outerRef=l,typeof c=="function"?c(l):c!=null&&typeof c=="object"&&c.hasOwnProperty("current")&&(c.current=l)},i._resetIsScrollingDebounced=function(){i._resetIsScrollingTimeoutId!==null&&Z(i._resetIsScrollingTimeoutId),i._resetIsScrollingTimeoutId=$e(i._resetIsScrolling,Fe)},i._resetIsScrolling=function(){i._resetIsScrollingTimeoutId=null,i.setState({isScrolling:!1},function(){i._getItemStyleCache(-1,null)})},i}_.getDerivedStateFromProps=function(i,l){return qe(i,l),y(i),null};var x=_.prototype;return x.scrollTo=function(i){i=Math.max(0,i),this.setState(function(l){return l.scrollOffset===i?null:{scrollDirection:l.scrollOffset<i?"forward":"backward",scrollOffset:i,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},x.scrollToItem=function(i,l){l===void 0&&(l="auto");var c=this.props,h=c.itemCount,v=c.layout,I=this.state.scrollOffset;i=Math.max(0,Math.min(i,h-1));var f=0;if(this._outerRef){var g=this._outerRef;v==="vertical"?f=g.scrollWidth>g.clientWidth?J():0:f=g.scrollHeight>g.clientHeight?J():0}this.scrollTo(a(this.props,i,l,I,this._instanceProps,f))},x.componentDidMount=function(){var i=this.props,l=i.direction,c=i.initialScrollOffset,h=i.layout;if(typeof c=="number"&&this._outerRef!=null){var v=this._outerRef;l==="horizontal"||h==="horizontal"?v.scrollLeft=c:v.scrollTop=c}this._callPropsCallbacks()},x.componentDidUpdate=function(){var i=this.props,l=i.direction,c=i.layout,h=this.state,v=h.scrollOffset,I=h.scrollUpdateWasRequested;if(I&&this._outerRef!=null){var f=this._outerRef;if(l==="horizontal"||c==="horizontal")if(l==="rtl")switch(X()){case"negative":f.scrollLeft=-v;break;case"positive-ascending":f.scrollLeft=v;break;default:var g=f.clientWidth,S=f.scrollWidth;f.scrollLeft=S-g-v;break}else f.scrollLeft=v;else f.scrollTop=v}this._callPropsCallbacks()},x.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&Z(this._resetIsScrollingTimeoutId)},x.render=function(){var i=this.props,l=i.children,c=i.className,h=i.direction,v=i.height,I=i.innerRef,f=i.innerElementType,g=i.innerTagName,S=i.itemCount,b=i.itemData,O=i.itemKey,N=O===void 0?Ue:O,j=i.layout,me=i.outerElementType,he=i.outerTagName,ve=i.style,pe=i.useIsScrolling,ge=i.width,B=this.state.isScrolling,L=h==="horizontal"||j==="horizontal",Ie=L?this._onScrollHorizontal:this._onScrollVertical,q=this._getRangeToRender(),Se=q[0],ye=q[1],H=[];if(S>0)for(var E=Se;E<=ye;E++)H.push(k.createElement(l,{data:b,key:N(E,b),index:E,isScrolling:pe?B:void 0,style:this._getItemStyle(E)}));var Q=n(this.props,this._instanceProps);return k.createElement(me||he||"div",{className:c,onScroll:Ie,ref:this._outerRefSetter,style:A({position:"relative",height:v,width:ge,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:h},ve)},k.createElement(f||g||"div",{children:H,ref:I,style:{height:L?"100%":Q,pointerEvents:B?"none":void 0,width:L?Q:"100%"}}))},x._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var i=this.props.itemCount;if(i>0){var l=this._getRangeToRender(),c=l[0],h=l[1],v=l[2],I=l[3];this._callOnItemsRendered(c,h,v,I)}}if(typeof this.props.onScroll=="function"){var f=this.state,g=f.scrollDirection,S=f.scrollOffset,b=f.scrollUpdateWasRequested;this._callOnScroll(g,S,b)}},x._getRangeToRender=function(){var i=this.props,l=i.itemCount,c=i.overscanCount,h=this.state,v=h.isScrolling,I=h.scrollDirection,f=h.scrollOffset;if(l===0)return[0,0,0,0];var g=o(this.props,f,this._instanceProps),S=m(this.props,g,f,this._instanceProps),b=!v||I==="backward"?Math.max(1,c):1,O=!v||I==="forward"?Math.max(1,c):1;return[Math.max(0,g-b),Math.max(0,Math.min(l-1,S+O)),g,S]},_}(k.PureComponent),e.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},e}var qe=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},He=50,P=function(e,t,n){var s=e,a=s.itemSize,o=n.itemMetadataMap,m=n.lastMeasuredIndex;if(t>m){var u=0;if(m>=0){var p=o[m];u=p.offset+p.size}for(var y=m+1;y<=t;y++){var M=a(y);o[y]={offset:u,size:M},u+=M}n.lastMeasuredIndex=t}return o[t]},Qe=function(e,t,n){var s=t.itemMetadataMap,a=t.lastMeasuredIndex,o=a>0?s[a].offset:0;return o>=n?le(e,t,a,0,n):Ke(e,t,Math.max(0,a),n)},le=function(e,t,n,s,a){for(;s<=n;){var o=s+Math.floor((n-s)/2),m=P(e,o,t).offset;if(m===a)return o;m<a?s=o+1:m>a&&(n=o-1)}return s>0?s-1:0},Ke=function(e,t,n,s){for(var a=e.itemCount,o=1;n<a&&P(e,n,t).offset<s;)n+=o,o*=2;return le(e,t,Math.min(n,a-1),Math.floor(n/2),s)},Y=function(e,t){var n=e.itemCount,s=t.itemMetadataMap,a=t.estimatedItemSize,o=t.lastMeasuredIndex,m=0;if(o>=n&&(o=n-1),o>=0){var u=s[o];m=u.offset+u.size}var p=n-o-1,y=p*a;return m+y},Ve=Be({getItemOffset:function(e,t,n){return P(e,t,n).offset},getItemSize:function(e,t,n){return n.itemMetadataMap[t].size},getEstimatedTotalSize:Y,getOffsetForIndexAndAlignment:function(e,t,n,s,a,o){var m=e.direction,u=e.height,p=e.layout,y=e.width,M=m==="horizontal"||p==="horizontal",_=M?y:u,x=P(e,t,a),R=Y(e,a),i=Math.max(0,Math.min(R-_,x.offset)),l=Math.max(0,x.offset-_+x.size+o);switch(n==="smart"&&(s>=l-_&&s<=i+_?n="auto":n="center"),n){case"start":return i;case"end":return l;case"center":return Math.round(l+(i-l)/2);case"auto":default:return s>=l&&s<=i?s:s<l?l:i}},getStartIndexForOffset:function(e,t,n){return Qe(e,n,t)},getStopIndexForStartIndex:function(e,t,n,s){for(var a=e.direction,o=e.height,m=e.itemCount,u=e.layout,p=e.width,y=a==="horizontal"||u==="horizontal",M=y?p:o,_=P(e,t,s),x=n+M,R=_.offset+_.size,i=t;i<m-1&&R<x;)i++,R+=P(e,i,s).size;return i},initInstanceProps:function(e,t){var n=e,s=n.estimatedItemSize,a={itemMetadataMap:{},estimatedItemSize:s||He,lastMeasuredIndex:-1};return t.resetAfterIndex=function(o,m){m===void 0&&(m=!0),a.lastMeasuredIndex=Math.min(a.lastMeasuredIndex,o-1),t._getItemStyleCache(-1),m&&t.forceUpdate()},a},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}});function ee(r,e){for(var t in r)if(!(t in e))return!0;for(var n in e)if(r[n]!==e[n])return!0;return!1}var Ge=["style"],Ze=["style"];function Je(r,e){var t=r.style,n=V(r,Ge),s=e.style,a=V(e,Ze);return!ee(t,s)&&!ee(n,a)}function Xe(r){const e=r.providers,t=Object.keys(e),n={};for(let s=0;s<t.length;s++){const a=t[s];n[a]={...e[a],idx:s}}return{byName:n,names:t}}async function Ye(r,e){const{url:t,init:n}=U(e);let s={providers:{}};try{const a=await fetch(t+r,n);a.ok&&(s=await a.json())}catch(a){console.log("failed to GET /providers/rules",a)}return Xe(s)}async function ce({name:r,apiConfig:e}){const{url:t,init:n}=U(e);try{return(await fetch(t+`/providers/rules/${r}`,{method:"PUT",...n})).ok}catch(s){return console.log("failed to PUT /providers/rules/:name",s),!1}}async function et({names:r,apiConfig:e}){for(let t=0;t<r.length;t++)await ce({name:r[t],apiConfig:e})}var tt=function(r,e,t,n,s,a,o,m){if(!r){var u;if(e===void 0)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var p=[t,n,s,a,o,m],y=0;u=new Error(e.replace(/%s/g,function(){return p[y++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}},rt=tt;function nt(r){return rt(r.rules&&r.rules.length>=0,"there is no valid rules list in the rules API response"),r.rules.map((e,t)=>({...e,id:t}))}async function st(r,e){let t={rules:[]};try{const{url:n,init:s}=U(e),a=await fetch(n+r,s);a.ok&&(t=await a.json())}catch(n){console.log("failed to fetch rules",n)}return nt(t)}const ue=Oe({key:"ruleFilterText",default:""});function it(r,e){const t=F(),{mutate:n,isLoading:s}=oe(ce,{onSuccess:()=>{t.invalidateQueries("/providers/rules")}});return[o=>{o.preventDefault(),n({name:r,apiConfig:e})},s]}function at(r){const e=F(),{data:t}=de(r),{mutate:n,isLoading:s}=oe(et,{onSuccess:()=>{e.invalidateQueries("/providers/rules")}});return[o=>{o.preventDefault(),n({names:t.names,apiConfig:r})},s]}function de(r){return se(["/providers/rules",r],()=>Ye("/providers/rules",r))}function ot(r){const{data:e,isFetching:t}=se(["/rules",r],()=>st("/rules",r)),{data:n}=de(r),[s]=ze(ue);if(s==="")return{rules:e,provider:n,isFetching:t};{const a=s.toLowerCase();return{rules:e.filter(o=>o.payload.toLowerCase().indexOf(a)>=0),isFetching:t,provider:{byName:n.byName,names:n.names.filter(o=>o.toLowerCase().indexOf(a)>=0)}}}}const lt="_RuleProviderItem_ly9yn_1",ct="_left_ly9yn_7",ut="_middle_ly9yn_14",dt="_gray_ly9yn_20",ft="_refreshButtonWrapper_ly9yn_24",C={RuleProviderItem:lt,left:ct,middle:ut,gray:dt,refreshButtonWrapper:ft};function mt({idx:r,name:e,vehicleType:t,behavior:n,updatedAt:s,ruleCount:a,apiConfig:o}){const[m,u]=it(e,o),p=je(new Date(s),new Date);return d.jsxs("div",{className:C.RuleProviderItem,children:[d.jsx("span",{className:C.left,children:r}),d.jsxs("div",{className:C.middle,children:[d.jsx(Te,{name:e,type:`${t} / ${n}`}),d.jsx("div",{className:C.gray,children:a<2?`${a} rule`:`${a} rules`}),d.jsxs("small",{className:C.gray,children:["Updated ",p," ago"]})]}),d.jsx("span",{className:C.refreshButtonWrapper,children:d.jsx(Ce,{onClick:m,disabled:u,children:d.jsx(ae,{isRotating:u})})})]})}function ht({apiConfig:r}){const[e,t]=at(r),{t:n}=ie();return d.jsx(ke,{icon:d.jsx(ae,{isRotating:t}),text:n("update_all_rule_provider"),style:Ae,onClick:e})}const vt="_rule_1e5p9_4",pt="_left_1e5p9_15",gt="_a_1e5p9_22",It="_b_1e5p9_29",St="_type_1e5p9_41",yt="_size_1e5p9_46",_t="_payloadAndSize_1e5p9_50",z={rule:vt,left:pt,a:gt,b:It,type:St,size:yt,payloadAndSize:_t},$={_default:"#59caf9",DIRECT:"#f5bc41",REJECT:"#cb3166"};function Rt({proxy:r}){let e=$._default;return $[r]&&(e=$[r]),{color:e}}function xt({type:r,payload:e,proxy:t,id:n,size:s}){const a=Rt({proxy:t});return d.jsxs("div",{className:z.rule,children:[d.jsx("div",{className:z.left,children:n}),d.jsxs("div",{style:{marginLeft:10},children:[d.jsxs("div",{className:z.payloadAndSize,children:[d.jsx("div",{className:z.payload,children:e}),(r==="GeoSite"||r==="GeoIP")&&d.jsxs("div",{style:{margin:"0 1em"},className:z.size,children:[" ","size: ",s]})]}),d.jsxs("div",{className:z.a,children:[d.jsx("div",{className:z.type,children:r}),d.jsx("div",{style:a,children:t})]})]})]})}const Mt="_header_10x16_4",bt="_RuleProviderItemWrapper_10x16_11",fe={header:Mt,RuleProviderItemWrapper:bt},{memo:Ot}=w,te=30;function zt(r,{rules:e,provider:t}){const n=t.names.length;return r<n?t.names[r]:e[r-n].id}function Tt({provider:r}){return function(t){const n=r.names.length;return t<n?90:60}}const Ct=Ot(({index:r,style:e,data:t})=>{const{rules:n,provider:s,apiConfig:a}=t,o=s.names.length;if(r<o){const u=s.names[r],p=s.byName[u];return d.jsx("div",{style:e,className:fe.RuleProviderItemWrapper,children:d.jsx(mt,{apiConfig:a,...p})})}const m=n[r-o];return d.jsx("div",{style:e,children:d.jsx(xt,{...m})})},Je),wt=r=>({apiConfig:Pe(r)}),$t=we(wt)(Pt);function Pt({apiConfig:r}){const[e,t]=Le(),{rules:n,provider:s}=ot(r),a=Tt({provider:s}),{t:o}=ie();return d.jsxs("div",{children:[d.jsxs("div",{className:fe.header,children:[d.jsx(Ee,{title:o("Rules")}),d.jsx(Ne,{textAtom:ue,placeholder:o("Search")})]}),d.jsx("div",{ref:e,style:{paddingBottom:te},children:d.jsx(Ve,{height:t-te,width:"100%",itemCount:n.length+s.names.length,itemSize:a,itemData:{rules:n,provider:s,apiConfig:r},itemKey:zt,children:Ct})}),s&&s.names&&s.names.length>0?d.jsx(ht,{apiConfig:r}):null]})}export{$t as default};
